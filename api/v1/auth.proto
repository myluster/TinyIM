syntax = "proto3";

package api.v1;

// 定义认证服务 (Service)
service AuthService {
  // 登录
  rpc Login (LoginReq) returns (LoginRes);

  // 注册
  rpc Register (RegisterReq) returns (RegisterRes);
  
  // 校验 Token
  rpc VerifyToken (VerifyTokenReq) returns (VerifyTokenRes);

  // 添加好友请求
  rpc AddFriend (AddFriendReq) returns (AddFriendRes);

  // 获取好友列表
  rpc GetFriendList (GetFriendListReq) returns (GetFriendListRes);

  // 处理好友请求 (接受/拒绝)
  rpc HandleFriendRequest (HandleFriendRequestReq) returns (HandleFriendRequestRes);

  // 获取待处理的好友请求列表
  rpc GetPendingFriendRequests (GetPendingFriendRequestsReq) returns (GetPendingFriendRequestsRes);

  // 删除好友
  rpc DeleteFriend (DeleteFriendReq) returns (DeleteFriendRes);
}

// --- 数据结构定义 (Message) ---

// 删除好友请求
message DeleteFriendReq {
  int64 user_id = 1;
  int64 friend_id = 2;
}

message DeleteFriendRes {
  bool success = 1;
  string error_msg = 2;
}

// --- 数据结构定义 (Message) ---

// 登录请求
message LoginReq {
  string username = 1; 
  string password = 2;
}

// 登录响应
message LoginRes {
  bool success = 1;
  int64 user_id = 2;
  string token = 3;
  string error_msg = 4;
}

// 注册请求
message RegisterReq {
  string username = 1;
  string password = 2;
}

message RegisterRes {
  bool success = 1;
  int64 user_id = 2;
  string error_msg = 3;
}

// Token 校验请求
message VerifyTokenReq {
  string token = 1;
}

// Token 校验响应
message VerifyTokenRes {
  bool valid = 1;
  int64 user_id = 2;
}

// 添加好友请求
message AddFriendReq {
  int64 user_id = 1;      // 发起人 ID
  int64 friend_id = 2;    // 目标好友 ID
}

message AddFriendRes {
  bool success = 1;
  string error_msg = 2;
}

// 获取好友列表请求
message GetFriendListReq {
  int64 user_id = 1;
}

message FriendInfo {
  int64 user_id = 1;
  string username = 2;
  int32 status = 3; // 0: Offline, 1: Online
}

message GetFriendListRes {
  bool success = 1;
  repeated FriendInfo friends = 2;
  string error_msg = 3;
}

// 处理好友请求
message HandleFriendRequestReq {
  int64 user_id = 1;      // 处理人 ID
  int64 request_id = 2;   // 请求 ID (或者 sender_id)
  bool accept = 3;        // true: 接受, false: 拒绝
}

message HandleFriendRequestRes {
  bool success = 1;
  string error_msg = 2;
}

// 获取待处理好友请求
message GetPendingFriendRequestsReq {
    int64 user_id = 1;
}

message FriendRequest {
    int64 request_id = 1;
    int64 sender_id = 2;
    string sender_username = 3;
    int64 created_at = 4;
}

message GetPendingFriendRequestsRes {
    bool success = 1;
    string error_msg = 2;
    repeated FriendRequest requests = 3;
}
